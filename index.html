<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Financeiro Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent-color: #4b5563; /* Cinza escuro neutro */
            --primary-btn: #2563eb; /* Azul s√≥brio */
            --success-btn: #059669;
            --danger-btn: #dc2626;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 { font-weight: 600; color: var(--text-primary); }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        /* Salary Input Section */
        .salary-section h3 { margin-bottom: 15px; font-size: 1.1rem; color: var(--text-secondary); }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        label { font-size: 0.9rem; font-weight: 600; color: var(--text-secondary); }
        
        input, select {
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-btn);
        }

        .stats {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-box {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-btn);
        }

        /* Chart Section */
        .chart-container {
            position: relative;
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Controls & List */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        button:hover { opacity: 0.9; }

        .btn-primary { background-color: var(--primary-btn); color: white; }
        .btn-success { background-color: var(--success-btn); color: white; }
        .btn-neutral { background-color: #fff; border: 1px solid #d1d5db; color: var(--text-primary); }
        .btn-danger { background-color: var(--danger-btn); color: white; }

        /* Expense List */
        .expense-list {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 15px 25px;
            background: #f9fafb;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .expense-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 15px 25px;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
            font-size: 0.95rem;
        }

        .expense-item:last-child { border-bottom: none; }

        .tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tag-pix { background: #dcfce7; color: #166534; }
        .tag-card { background: #dbeafe; color: #1e40af; }
        .tag-cash { background: #fef9c3; color: #854d0e; }

        .delete-btn {
            background: transparent;
            color: var(--danger-btn);
            padding: 5px;
            font-size: 1.2rem;
            width: fit-content;
        }

        /* Mobile Responsive List */
        @media (max-width: 600px) {
            .table-header { display: none; }
            .expense-item {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 20px;
                position: relative;
            }
            .expense-item span:first-child { font-weight: bold; font-size: 1.1rem; }
            .delete-btn { position: absolute; top: 15px; right: 15px; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(2px);
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header { margin-bottom: 20px; display: flex; justify-content: space-between; }
        .modal-footer { margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Gestor de Contas</h1>
            <div style="display: flex; gap: 10px;">
                <button class="btn-neutral" onclick="triggerImport()">üìÇ Importar</button>
                <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(this)">
                <button class="btn-success" onclick="exportData()">üíæ Exportar Dados</button>
            </div>
        </header>

        <div class="dashboard">
            <div class="card">
                <div class="salary-section">
                    <h3>Defini√ß√µes do M√™s</h3>
                    <div class="input-group">
                        <label>Sal√°rio / Renda Mensal (R$)</label>
                        <input type="number" id="salaryInput" placeholder="0,00" oninput="updateDashboard()">
                    </div>
                </div>
                <div class="stats">
                    <div class="stat-box">
                        <small>Total Gasto</small>
                        <div class="stat-value" id="totalSpent">R$ 0,00</div>
                    </div>
                    <div class="stat-box">
                        <small>Restante</small>
                        <div class="stat-value" id="remaining" style="color: var(--success-btn);">R$ 0,00</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="openModal()">+ Adicionar Conta</button>
            <button class="btn-danger" onclick="clearAllData()">üóëÔ∏è Limpar Tudo</button>
        </div>

        <div class="expense-list">
            <div class="table-header">
                <span>Descri√ß√£o</span>
                <span>Valor</span>
                <span>M√©todo</span>
                <span>A√ß√£o</span>
            </div>
            <div id="expensesContainer">
                </div>
        </div>
    </div>

    <div class="modal-overlay" id="expenseModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Nova Conta</h2>
                <span onclick="closeModal()" style="cursor:pointer; font-size: 1.5rem;">&times;</span>
            </div>
            <form id="expenseForm" onsubmit="addExpense(event)">
                <div class="input-group">
                    <label>Descri√ß√£o (Item/Servi√ßo)</label>
                    <input type="text" id="descInput" required placeholder="Ex: Internet, Aluguel...">
                </div>
                <div class="input-group">
                    <label>Valor (R$)</label>
                    <input type="number" step="0.01" id="valueInput" required placeholder="0.00">
                </div>
                <div class="input-group">
                    <label>M√©todo de Pagamento</label>
                    <select id="methodInput">
                        <option value="pix">Pix</option>
                        <option value="cartao">Cart√£o de Cr√©dito</option>
                        <option value="dinheiro">Dinheiro</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-neutral" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Estado da Aplica√ß√£o ---
        let appData = {
            salary: 0,
            expenses: []
        };
        let chartInstance = null;

        // --- Inicializa√ß√£o ---
        document.addEventListener('DOMContentLoaded', () => {
            loadFromCache();
            renderAll();
        });

        // --- Fun√ß√µes de Gr√°fico ---
        function initChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            // Se j√° existe, destr√≥i para recriar
            if (chartInstance) chartInstance.destroy();

            const totalSpent = appData.expenses.reduce((acc, curr) => acc + curr.value, 0);
            const salary = appData.salary > 0 ? appData.salary : (totalSpent > 0 ? totalSpent : 1); // Evita div por 0
            
            let remaining = salary - totalSpent;
            if (remaining < 0) remaining = 0;

            const percentageUsed = appData.salary > 0 ? ((totalSpent / appData.salary) * 100).toFixed(1) : 0;

            // Configura√ß√£o do Gr√°fico
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Gasto', 'Dispon√≠vel'],
                    datasets: [{
                        data: [totalSpent, remaining],
                        backgroundColor: ['#2563eb', '#e5e7eb'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) label += ': ';
                                    label += formatCurrency(context.raw);
                                    return label;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'textCenter',
                    beforeDraw: function(chart) {
                        var width = chart.width, height = chart.height, ctx = chart.ctx;
                        ctx.restore();
                        var fontSize = (height / 114).toFixed(2);
                        ctx.font = "bold " + fontSize + "em sans-serif";
                        ctx.textBaseline = "middle";
                        ctx.fillStyle = "#1f2937";
                        var text = percentageUsed + "%",
                            textX = Math.round((width - ctx.measureText(text).width) / 2),
                            textY = height / 2;
                        
                        // S√≥ mostra o texto se houver sal√°rio definido
                        if(appData.salary > 0) {
                            ctx.fillText(text, textX, textY);
                        }
                        ctx.save();
                    }
                }]
            });
        }

        // --- L√≥gica Principal ---

        function addExpense(e) {
            e.preventDefault();
            const desc = document.getElementById('descInput').value;
            const value = parseFloat(document.getElementById('valueInput').value);
            const method = document.getElementById('methodInput').value;

            if (desc && value) {
                appData.expenses.push({
                    id: Date.now(),
                    description: desc,
                    value: value,
                    method: method
                });
                saveToCache();
                renderAll();
                closeModal();
                e.target.reset();
            }
        }

        function removeExpense(id) {
            if(confirm('Deseja remover este item?')) {
                appData.expenses = appData.expenses.filter(item => item.id !== id);
                saveToCache();
                renderAll();
            }
        }

        function updateDashboard() {
            const salaryInput = document.getElementById('salaryInput');
            appData.salary = parseFloat(salaryInput.value) || 0;
            saveToCache();
            renderDashboard();
        }

        function renderAll() {
            // Atualiza Input Sal√°rio
            document.getElementById('salaryInput').value = appData.salary || '';
            
            renderList();
            renderDashboard();
        }

        function renderDashboard() {
            const totalSpent = appData.expenses.reduce((acc, curr) => acc + curr.value, 0);
            const remaining = appData.salary - totalSpent;

            document.getElementById('totalSpent').textContent = formatCurrency(totalSpent);
            
            const remainingEl = document.getElementById('remaining');
            remainingEl.textContent = formatCurrency(remaining);
            
            if (remaining < 0) {
                remainingEl.style.color = 'var(--danger-btn)';
                remainingEl.textContent = formatCurrency(remaining); 
            } else {
                remainingEl.style.color = 'var(--success-btn)';
            }

            initChart();
        }

        function renderList() {
            const container = document.getElementById('expensesContainer');
            container.innerHTML = '';

            appData.expenses.forEach(item => {
                const div = document.createElement('div');
                div.className = 'expense-item';
                
                let methodClass = '';
                if (item.method === 'pix') methodClass = 'tag-pix';
                else if (item.method === 'cartao') methodClass = 'tag-card';
                else methodClass = 'tag-cash';

                div.innerHTML = `
                    <span>${item.description}</span>
                    <span>${formatCurrency(item.value)}</span>
                    <span><span class="tag ${methodClass}">${item.method}</span></span>
                    <button class="delete-btn" onclick="removeExpense(${item.id})">&times;</button>
                `;
                container.appendChild(div);
            });
        }

        // --- Utilit√°rios ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        // --- Modal ---
        function openModal() {
            document.getElementById('expenseModal').classList.add('active');
            document.getElementById('descInput').focus();
        }
        function closeModal() {
            document.getElementById('expenseModal').classList.remove('active');
        }
        // Fechar ao clicar fora
        document.getElementById('expenseModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('expenseModal')) closeModal();
        });

        // --- Persist√™ncia e Dados (JSON) ---

        function saveToCache() {
            localStorage.setItem('gestorFinanceiroData', JSON.stringify(appData));
        }

        function loadFromCache() {
            const data = localStorage.getItem('gestorFinanceiroData');
            if (data) {
                appData = JSON.parse(data);
            }
        }

        function clearAllData() {
            if(confirm('Tem certeza que deseja apagar todos os dados e limpar o cache?')) {
                appData = { salary: 0, expenses: [] };
                localStorage.removeItem('gestorFinanceiroData');
                renderAll();
            }
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            const date = new Date().toISOString().slice(0,10);
            downloadAnchorNode.setAttribute("download", `financas_backup_${date}.json`);
            document.body.appendChild(downloadAnchorNode); // Firefox requer
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function triggerImport() {
            document.getElementById('importFile').click();
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (json.salary !== undefined && Array.isArray(json.expenses)) {
                        appData = json;
                        saveToCache();
                        renderAll();
                        alert('Dados importados com sucesso!');
                    } else {
                        alert('Formato de arquivo inv√°lido.');
                    }
                } catch (err) {
                    alert('Erro ao ler o arquivo JSON.');
                }
            };
            reader.readAsText(file);
            // Reseta o input para permitir importar o mesmo arquivo novamente se necess√°rio
            input.value = '';
        }
    </script>
</body>
</html>
 
